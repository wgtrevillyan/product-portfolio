# William Trevillyan's Product Portfolio

A static portfolio site showcasing products, companies, patents, and skills. Content is driven by JSON in `data/` and injected client-side; assets are local (no Webflow CDN dependency).

**Live site:** [trevillyan.dev](https://www.trevillyan.dev)

## Tech Stack

- **Frontend:** Static HTML, CSS (originally from Webflow export), vanilla JavaScript
- **Content:** JSON in `data/` loaded by `js/cms-data.js` and rendered into the DOM
- **Assets:** Images and SVGs in `images/` (companies, products, patents, product-images)
- **Hosting:** Vercel (static files + serverless API)
- **Contact form:** Vercel serverless function (`api/contact.js`) using Nodemailer + Gmail SMTP

## Getting Started

### Prerequisites

- **Node.js 18+** (for build scripts and optional local dev)
- **npm**
- **Vercel CLI** (optional, for `vercel dev` with rewrites)

### Install

```bash
npm install
```

### Build

```bash
npm run build
```

The build runs:

1. **Header injection** — Injects `components/header.html` into each page with correct nav highlighting
2. **Footer injection** — Injects `components/footer.html`
3. **Clean URLs** — Replaces `.html` links with path-based URLs
4. **Root asset paths** — Converts relative asset paths to root-relative (required for clean URLs like `/products/clip360`)
5. **Sitemap** — Generates `sitemap.xml` from static routes and `data/*.json` (companies, products, patents)

### Development

Run the site locally with Vercel’s dev server (rewrites and serverless routes work as in production):

```bash
vercel dev
```

Install the [Vercel CLI](https://vercel.com/docs/cli) if needed: `npm i -g vercel`.

## Project Structure

```
├── api/                  # Vercel serverless functions
│   └── contact.js        # Contact form handler
├── components/           # Reusable HTML partials
│   ├── header.html
│   └── footer.html
├── css/                  # Stylesheets
├── data/                 # CMS content (JSON)
│   ├── products.json
│   ├── companies.json
│   ├── patents.json
│   ├── skills.json
│   ├── tags.json
│   └── product-images.json
├── images/               # Static assets
├── js/
│   ├── cms-data.js       # Fetches JSON and populates HTML
│   └── webflow.js        # Webflow interactions
├── scripts/              # Build scripts
│   ├── inject-header.js
│   ├── inject-footer.js
│   ├── clean-urls.js
│   ├── root-asset-paths.js
│   ├── generate-sitemap.js
│   └── download-webflow-assets.js
├── vercel.json           # Rewrites and build config
├── sitemap.xml           # Generated by build; submit to search engines
└── *.html                # Page templates
```

## Deployment

Deploy to Vercel:

```bash
vercel
```

Or connect the repo to Vercel for automatic deploys on push.

### Environment Variables

For the contact form, set these in the Vercel project (or in `.env.local` when using `vercel dev`; `.env*.local` is gitignored):

| Variable | Description |
|----------|-------------|
| `SMTP_USER` | Gmail address (e.g. `no-reply@yourdomain.com`) |
| `SMTP_APP_PASSWORD` | Gmail App Password (not your normal password) |

## Clean URLs

The site uses path-based URLs instead of `.html`:

| URL | Serves |
|-----|--------|
| `/` | Home |
| `/products` | Products list |
| `/products/clip360` | Product detail (by slug) |
| `/companies` | Companies list |
| `/companies/property-meld` | Company detail |
| `/patents` | Patents list |
| `/patents/:slug` | Patent detail |
| `/let-us-chat` | Contact form |

## Sitemap

The build generates `sitemap.xml` with all public URLs (home, list pages, and each company/product/patent detail). Default base URL is `https://www.trevillyan.dev`; override when building for another domain:

```bash
SITE_URL=https://example.com npm run build
```

Submit [trevillyan.dev/sitemap.xml](https://www.trevillyan.dev/sitemap.xml) in Google Search Console (or similar) for indexing.

## Content Management

Edit the JSON files in `data/` to change products, companies, patents, and skills. See [data/README.md](data/README.md) for schemas and image migration (`npm run download-assets`).

## Scripts

| Script | Description |
|--------|-------------|
| `npm run build` | Full build: header/footer injection, clean URLs, root asset paths, sitemap |
| `npm run build:header` | Inject shared header only |
| `npm run build:footer` | Inject shared footer only |
| `npm run cleanup` | Replace full header/footer markup with placeholders (one-time cleanup) |
| `npm run download-assets` | Download Webflow CDN assets to `images/` and point JSON at local paths |
